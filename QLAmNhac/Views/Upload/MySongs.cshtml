@model IEnumerable<QLAmNhac.Models.BaiHat>

@{
    ViewBag.Title = "Nhạc của tôi";
}

<div class="container" style="margin-top: 40px;">
    <h2 style="color: #fff; border-bottom: 1px solid #333; padding-bottom: 10px;">
        <i class="fa fa-music"></i> Nhạc đã đăng
        <a href="@Url.Action("Create")" class="btn btn-success pull-right"><i class="fa fa-plus"></i> Đăng mới</a>
    </h2>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    <div class="table-responsive" style="margin-top: 20px;">
        <table class="table table-hover" style="color: #ddd;">
            <thead>
                <tr style="background-color: #282828;">
                    <th>Thumbnail</th>
                    <th>Thông tin</th>
                    <th>Trạng thái</th>
                    <th class="text-right">Hành động</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr id="row-@item.MaBaiHat">
                        <td width="120">
                            <img src="https://img.youtube.com/vi/@item.LinkYoutube/mqdefault.jpg" style="width: 100px; border-radius: 4px;" />
                        </td>
                        <td>
                            <strong style="font-size: 16px;">@item.TenBaiHat</strong><br />
                            <span class="text-muted"><i class="fa fa-microphone"></i> @item.NguoiTrinhBay</span><br />
                            <small class="text-muted"><i class="fa fa-clock"></i> @(item.NgayDang.HasValue ? item.NgayDang.Value.ToString("dd/MM/yyyy") : "")</small>
                        </td>
                        <td>
                            @if (item.TrangThaiDuyet == 1)
                            {<span class="label label-success">Đã duyệt</span> }
                            else if (item.TrangThaiDuyet == 0)
                            { <span class="label label-warning">Đang chờ</span> }
                            else
                            { <span class="label label-danger" title="@item.GhiChuAdmin">Bị từ chối</span>}
                        </td>
                        <td class="text-right">
                            <!-- Nút Sửa -->
                            <a href="@Url.Action("Edit", "Upload", new { id = item.MaBaiHat })" class="btn btn-primary btn-sm">
                                <i class="fa fa-edit"></i> Sửa
                            </a>

                            <!-- Nút Xóa (Dùng JS + AJAX) -->
                            <button class="btn btn-danger btn-sm" onclick="deleteSong(@item.MaBaiHat)">
                                <i class="fa fa-trash"></i> Xóa
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section scripts {
    <script>
        function deleteSong(id) {
            if(!confirm("CẢNH BÁO: Bạn có chắc chắn muốn xóa bài hát này? Hành động này không thể hoàn tác!")) return;

            $.ajax({
                url: '/Upload/Delete',
                type: 'POST',
                data: { id: id },
                success: function(res) {
                    if(res.success) {
                        $('#row-' + id).fadeOut(); // Ẩn dòng đã xóa
                    } else {
                        alert(res.msg);
                    }
                },
                error: function() {
                    alert("Lỗi kết nối server!");
                }
            });
        }
    </script>
}