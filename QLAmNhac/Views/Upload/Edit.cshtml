@model QLAmNhac.Models.BaiHat

@{
    ViewBag.Title = "Chỉnh sửa bài hát";
    var listTags = ViewBag.Tags as List<QLAmNhac.Models.Tag>;
    var selectedTags = ViewBag.SelectedTags as List<int>;
}

<div class="container" style="margin-top: 50px;">
    <div class="row">
        <div class="col-md-8 col-md-offset-2">

            <div class="panel panel-default" style="background-color: #181818; border: 1px solid #333;">
                <div class="panel-heading" style="background-color: #282828; border-bottom: 1px solid #333; padding: 15px;">
                    <h3 class="panel-title" style="color: #1db954; font-weight: bold;">
                        <i class="fa fa-edit"></i> Chỉnh sửa: @Model.TenBaiHat
                    </h3>
                </div>

                <div class="panel-body" style="padding: 30px;">
                    @using (Html.BeginForm())
                    {
                        @Html.AntiForgeryToken()
                        @Html.HiddenFor(model => model.MaBaiHat) <!-- Quan trọng: Giữ ID bài hát -->

                        <div class="form-horizontal">
                            @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                            <!-- Tên bài hát -->
                            <div class="form-group">
                                <label class="control-label" style="color: #ddd;">Tên bài hát</label>
                                @Html.EditorFor(model => model.TenBaiHat, new { htmlAttributes = new { @class = "form-control", @style = "background: #111; border: 1px solid #444; color: #fff;" } })
                                @Html.ValidationMessageFor(model => model.TenBaiHat, "", new { @class = "text-danger" })
                            </div>

                            <!-- Link Youtube -->
                            <div class="form-group">
                                <label class="control-label" style="color: #ddd;">Link YouTube</label>
                                <!-- Hiện link cũ -->
                                <input type="text" name="LinkYoutube" value="https://www.youtube.com/watch?v=@Model.LinkYoutube" class="form-control" style="background: #111; border: 1px solid #444; color: #fff;" />
                                @Html.ValidationMessageFor(model => model.LinkYoutube, "", new { @class = "text-danger" })
                            </div>

                            <!-- Nghệ sĩ -->
                            <div class="form-group">
                                <label class="control-label" style="color: #ddd;">Nghệ sĩ trình bày</label>
                                @Html.EditorFor(model => model.NguoiTrinhBay, new { htmlAttributes = new { @class = "form-control", @style = "background: #111; border: 1px solid #444; color: #fff;" } })
                            </div>

                            <!-- Tag (Checkbox có check sẵn) -->
                            <div class="form-group">
                                <label class="control-label" style="color: #ddd;">Thể loại</label>
                                <div style="background: #111; border: 1px solid #444; padding: 10px; border-radius: 4px; max-height: 150px; overflow-y: auto;">
                                    @if (listTags != null)
                                    {
                                        foreach (var tag in listTags)
                                        {
                                            // Kiểm tra xem tag này có trong list selectedTags không
                                            bool isChecked = selectedTags != null && selectedTags.Contains(tag.MaTag);

                                            <div class="checkbox" style="color: #ccc;">
                                                <label>
                                                    <input type="checkbox" name="selectedTags" value="@tag.MaTag" @(isChecked ? "checked" : "") />
                                                    <span style="font-weight: bold;">#@tag.TenTag</span>
                                                </label>
                                            </div>
                                        }
                                    }
                                </div>
                            </div>

                            <hr style="border-color: #333;" />

                            <div class="form-group text-right">
                                <a href="@Url.Action("MySongs", "Upload")" class="btn btn-default" style="background: transparent; color: #bbb; border: 1px solid #555;">Quay lại</a>
                                <button type="submit" class="btn btn-primary" style="font-weight: bold; padding: 8px 30px;">
                                    <i class="fa fa-save"></i> Cập nhật
                                </button>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>