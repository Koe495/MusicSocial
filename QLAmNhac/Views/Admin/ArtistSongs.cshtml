@model IEnumerable<QLAmNhac.Models.BaiHat>

@{
    ViewBag.Title = "Quản lý nhạc nghệ sĩ";
}

<div class="container" style="margin-top: 40px;">
    <h3 style="color: #fff; border-bottom: 1px solid #333; padding-bottom: 15px;">
        Nhạc của nghệ sĩ: <span style="color: #1db954;">@ViewBag.ArtistName</span>
    </h3>

    <a href="@Url.Action("ArtistManager")" class="btn btn-default btn-sm" style="background: #333; color: #fff; border: 1px solid #555; margin-top: 10px;">
        <i class="fa fa-arrow-left"></i> Quay lại danh sách nghệ sĩ
    </a>

    <div class="table-responsive" style="margin-top: 20px;">
        <table class="table table-hover" style="color: #ddd;">
            <thead>
                <tr style="background-color: #282828;">
                    <th style="width: 80px;">Ảnh</th>
                    <th>Bài hát</th>
                    <th>Ngày đăng</th>
                    <th>Trạng thái</th>
                    <th class="text-right">Hành động</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.Count() == 0)
                {
                    <tr>
                        <td colspan="5" class="text-center text-muted" style="padding: 20px;">Nghệ sĩ này chưa đăng bài hát nào.</td>
                    </tr>
                }
                else
                {
                    foreach (var item in Model)
                    {
                        <tr id="row-@item.MaBaiHat" style="border-bottom: 1px solid #333; transition: background-color 0.2s;">
                            <td>
                                <img src="https://img.youtube.com/vi/@item.LinkYoutube/mqdefault.jpg" style="width: 60px; border-radius: 4px;" />
                            </td>
                            <td>
                                <strong style="font-size: 15px;">@item.TenBaiHat</strong>
                            </td>
                            <td>@(item.NgayDang.HasValue ? item.NgayDang.Value.ToString("dd/MM/yyyy") : "")</td>
                            <td>
                                @if (item.TrangThaiDuyet == 1)
                                {
                                    <span class="label label-success">Công khai</span>
                                }
                                else if (item.TrangThaiDuyet == 0)
                                {
                                    <span class="label label-warning">Chờ duyệt</span>
                                }
                                else
                                {
                                    <span class="label label-danger">Đã ẩn/Từ chối</span>
                                }
                            </td>
                            <td class="text-right">
                                <a href="@Url.Action("Details", "Songs", new { id = item.MaBaiHat })" class="btn btn-info btn-xs" target="_blank" title="Xem chi tiết">
                                    <i class="fa fa-eye"></i>
                                </a>
                                <button class="btn btn-danger btn-xs" onclick="deleteSong(@item.MaBaiHat)" title="Xóa bài hát này">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

@section scripts {
    <script>
        function deleteSong(id) {
            if (!confirm("CẢNH BÁO ADMIN: Bạn có chắc chắn muốn xóa vĩnh viễn bài hát này của nghệ sĩ?")) return;

            $.ajax({
                // Admin có thể dùng chung API xóa của UploadController vì đã check quyền Admin ở đó
                url: '/Upload/Delete',
                type: 'POST',
                data: { id: id },
                success: function (res) {
                    if (res.success) {
                        $('#row-' + id).fadeOut();
                    } else {
                        alert(res.msg);
                    }
                },
                error: function () {
                    alert("Lỗi kết nối server!");
                }
            });
        }
    </script>
}