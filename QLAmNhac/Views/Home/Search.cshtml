@model IEnumerable<QLAmNhac.Models.BaiHat>

@{
    ViewBag.Title = "Kết quả tìm kiếm";
}

<div class="container" style="margin-top: 30px;">
    <h2 class="text-white">
        <i class="fa fa-search"></i> Kết quả tìm kiếm cho: 
        <span style="color: #1db954;">"@ViewBag.Keyword"</span>
    </h2>
    <p class="text-muted">Tìm thấy @Model.Count() kết quả.</p>
    <hr style="border-color: #333;" />

    <div class="row">
        @if (Model.Count() == 0)
        {
            <div class="col-md-12 text-center" style="padding: 50px;">
                <i class="fa fa-frown-open" style="font-size: 50px; color: #555;"></i>
                <h3 class="text-muted">Không tìm thấy bài hát nào.</h3>
                <p>Hãy thử tìm theo tên bài hát, nghệ sĩ, hoặc thể loại (VD: Pop, Buồn, Chill...)</p>
                <a href="@Url.Action("Index", "Home")" class="btn btn-success">Về trang chủ</a>
            </div>
        }
        else
        {
            foreach (var item in Model)
            {
                <div class="col-md-3 col-sm-6 mb-4">
                    <div class="music-card">
                        <div style="position: relative;">
                            <img src="https://img.youtube.com/vi/@item.LinkYoutube/hqdefault.jpg" class="card-img-top" alt="@item.TenBaiHat">
                            <div class="play-overlay">
                                <a href="@Url.Action("Details", "Songs", new { id = item.MaBaiHat })" class="btn-play-card">
                                    <i class="fa fa-play"></i>
                                </a>
                            </div>
                        </div>

                        <div class="card-body">
                            <h5 class="card-title">
                                <a href="@Url.Action("Details", "Songs", new { id = item.MaBaiHat })" class="text-decoration-none text-white">
                                    @item.TenBaiHat
                                </a>
                            </h5>
                            <p class="card-text mb-2">@item.NguoiTrinhBay</p>

                            <!-- HIỂN THỊ TAG TRÊN CARD (Mới) -->
                            <div class="card-tags">
                                @{
                                    // Lấy Top 3 Tag được vote nhiều nhất của bài này
                                    var topTags = item.TagVotes
                                        .GroupBy(tv => tv.Tag.TenTag)
                                        .Select(g => new { Name = g.Key, Count = g.Count() })
                                        .OrderByDescending(t => t.Count)
                                        .Take(3);
                                }
                                
                                @foreach (var tag in topTags)
                                {
                                    <span class="badge" style="background: #333; color: #bbb; font-weight: normal; font-size: 10px;">#@tag.Name</span>
                                }
                            </div>
                            <!-- Hết phần hiển thị Tag -->

                        </div>
                    </div>
                </div>
            }
        }
    </div>
</div>